<!-- templates/index.html -->
{% extends "base.html" %}

{% block title %}홈 - 수학 Q&A 시스템{% endblock %}
{% block og_title %}AI와 함께하는 수학 학습{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section mb-5">
    <div class="row">
        <div class="col-md-12">
            <div class="jumbotron bg-gradient p-5 rounded-3 text-center">
                <div class="animate-fadeIn">
                    <h1 class="display-4 fw-bold mb-3">
                        <i class="fas fa-brain me-3 text-primary"></i>
                        수학 문제 해결 시스템
                    </h1>
                    <p class="lead mb-4">
                        LangChain Agent를 활용한 지능형 수학 교육 플랫폼입니다.<br>
                        Wikipedia 검색, 수학 계산, arXiv 논문 검색 기능을 통합하여 포괄적인 학습 경험을 제공합니다.
                    </p>
                    
                    <!-- 서비스 상태 -->
                    {% if service_status %}
                        {% if service_status.is_available %}
                        <div class="alert alert-success mb-4 animate-slideInUp">
                            <i class="fas fa-check-circle me-2"></i>
                            <strong>시스템 정상:</strong> 모든 AI 기능이 정상적으로 작동합니다.
                            <div class="mt-2 small">
                                <i class="fas fa-tools me-1"></i>
                                활성화된 도구: Wikipedia, 수학계산기, arXiv 검색
                            </div>
                        </div>
                        {% else %}
                        <div class="alert alert-warning mb-4">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>주의:</strong> {{ service_status.error_message or "AI 서비스에 문제가 있습니다." }}
                            <br><small>일부 기능이 제한될 수 있습니다.</small>
                        </div>
                        {% endif %}
                    {% endif %}
                    
                    <div class="cta-buttons">
                        <a href="#problems-section" class="btn btn-primary btn-lg me-3">
                            <i class="fas fa-rocket me-2"></i>
                            문제 풀기 시작
                        </a>
                        <button class="btn btn-outline-secondary btn-lg" onclick="showSystemInfo()">
                            <i class="fas fa-info-circle me-2"></i>
                            시스템 정보
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 학습 진도 -->
<section class="progress-section mb-5" id="progress-section">
    <div class="row">
        <div class="col-md-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-transparent">
                    <h4 class="mb-0">
                        <i class="fas fa-chart-line me-2 text-success"></i>
                        학습 진도
                    </h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="progress mb-3" style="height: 25px;">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                     role="progressbar" 
                                     id="progressBar"
                                     style="width: 0%"
                                     aria-valuenow="0" 
                                     aria-valuemin="0" 
                                     aria-valuemax="100">
                                    0%
                                </div>
                            </div>
                            <p class="text-muted mb-0" id="progressText">
                                학습을 시작해보세요!
                            </p>
                        </div>
                        <div class="col-md-4">
                            <div class="stats-grid">
                                <div class="stat-item text-center">
                                    <div class="stat-number text-primary fw-bold" id="solvedCount">0</div>
                                    <div class="stat-label small text-muted">완료</div>
                                </div>
                                <div class="stat-item text-center">
                                    <div class="stat-number text-warning fw-bold" id="attemptedCount">0</div>
                                    <div class="stat-label small text-muted">시도</div>
                                </div>
                                <div class="stat-item text-center">
                                    <div class="stat-number text-info fw-bold">5</div>
                                    <div class="stat-label small text-muted">전체</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 문제 필터링 -->
<section class="filter-section mb-4" id="problems-section">
    <div class="row">
        <div class="col-md-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>
                    <i class="fas fa-list me-2"></i>
                    문제 목록
                    <small class="text-muted">({{ problems|length }}개)</small>
                </h2>
                <div class="btn-group" role="group" aria-label="난이도 필터">
                    <button type="button" class="btn btn-outline-primary active" data-filter="all">
                        <i class="fas fa-th me-1"></i>
                        전체
                    </button>
                    <button type="button" class="btn btn-outline-success" data-filter="초급">
                        <i class="fas fa-seedling me-1"></i>
                        초급
                    </button>
                    <button type="button" class="btn btn-outline-warning" data-filter="중급">
                        <i class="fas fa-mountain me-1"></i>
                        중급
                    </button>
                    <button type="button" class="btn btn-outline-danger" data-filter="고급">
                        <i class="fas fa-crown me-1"></i>
                        고급
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 문제 카드들 -->
<section class="problems-grid">
    <div class="row" id="problemsContainer">
        {% for problem in problems %}
        <div class="col-md-6 mb-4 problem-item animate-delay-{{ loop.index }}" 
             data-difficulty="{{ problem.difficulty }}"
             data-problem-id="{{ problem.id }}">
            <div class="card problem-card h-100 shadow-sm">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 d-flex align-items-center">
                        <span class="problem-number badge bg-primary me-2">{{ problem.id }}</span>
                        <span class="problem-title">{{ problem.title }}</span>
                    </h5>
                    <div class="badges">
                        <span class="badge difficulty-badge bg-{% if problem.difficulty == '초급' %}success{% elif problem.difficulty == '중급' %}warning{% else %}danger{% endif %}">
                            {{ problem.difficulty }}
                        </span>
                        <span class="badge bg-light text-dark problem-status" id="status-{{ problem.id }}"></span>
                    </div>
                </div>
                <div class="card-body">
                    <p class="card-text problem-preview">
                        {{ problem.problem[:120] }}{% if problem.problem|length > 120 %}...{% endif %}
                    </p>
                    
                    <div class="topics mb-3">
                        <small class="text-muted d-block mb-2">
                            <i class="fas fa-tags me-1"></i>
                            관련 주제:
                        </small>
                        {% for topic in problem.topics %}
                        <span class="badge topic-badge bg-secondary me-1">{{ topic }}</span>
                        {% endfor %}
                    </div>
                    
                    <div class="problem-meta mb-3">
                        <div class="row text-center">
                            <div class="col-4">
                                <small class="text-muted">예상시간</small>
                                <div class="fw-bold estimated-time" data-topics="{{ problem.topics|join(',') }}">
                                    {% if problem.difficulty == '초급' %}15분{% elif problem.difficulty == '중급' %}25분{% else %}40분{% endif %}
                                </div>
                            </div>
                            <div class="col-4">
                                <small class="text-muted">주제수</small>
                                <div class="fw-bold">{{ problem.topics|length }}개</div>
                            </div>
                            <div class="col-4">
                                <small class="text-muted">상태</small>
                                <div class="fw-bold status-text" id="statusText-{{ problem.id }}">대기</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-transparent">
                    <div class="d-flex justify-content-between align-items-center">
                        <a href="{{ url_for('problem_detail', problem_id=problem.id) }}" 
                           class="btn btn-primary flex-grow-1 me-2">
                            <i class="fas fa-play me-1"></i>
                            문제 풀기
                        </a>
                        <button class="btn btn-outline-secondary" 
                                onclick="previewProblem({{ problem.id }})"
                                title="미리보기">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="problem-hint mt-2">
                        <small class="text-muted">
                            <i class="fas fa-lightbulb me-1"></i>
                            {{ problem.hint[:50] }}{% if problem.hint|length > 50 %}...{% endif %}
                        </small>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>

<!-- 도움말 섹션 -->
<section class="help-section mt-5">
    <div class="row">
        <div class="col-md-12">
            <div class="card border-0 bg-light">
                <div class="card-body">
                    <h5>
                        <i class="fas fa-question-circle me-2 text-info"></i>
                        사용법 안내
                    </h5>
                    <div class="row">
                        <div class="col-md-4">
                            <h6><i class="fas fa-1 me-2"></i>문제 선택</h6>
                            <p class="small text-muted">원하는 난이도의 문제를 선택하세요.</p>
                        </div>
                        <div class="col-md-4">
                            <h6><i class="fas fa-2 me-2"></i>답안 작성</h6>
                            <p class="small text-muted">단계별로 풀이 과정을 작성하세요.</p>
                        </div>
                        <div class="col-md-4">
                            <h6><i class="fas fa-3 me-2"></i>AI 피드백</h6>
                            <p class="small text-muted">AI가 상세한 피드백을 제공합니다.</p>
                        </div>
                    </div>
                    <div class="text-center mt-3">
                        <button class="btn btn-outline-primary btn-sm" onclick="showKeyboardShortcuts()">
                            <i class="fas fa-keyboard me-1"></i>
                            키보드 단축키 보기
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/utils.js') }}"></script>
{% endblock %}
